# Arrmate â€” docker-compose.ollama-nvidia.yml
#
# NVIDIA GPU override for Ollama.
# Merges with the base compose file via COMPOSE_FILE in .env:
#
#   COMPOSE_FILE=docker-compose.yml:docker-compose.ollama-nvidia.yml
#   (or use docker-compose.prod.yml as the base)
#
# REQUIREMENTS:
#   - NVIDIA GPU with CUDA support
#   - nvidia-container-toolkit installed on the host
#     https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html
#   - Docker daemon configured with nvidia runtime
#     (nvidia-ctk runtime configure --runtime=docker && systemctl restart docker)
#
# VERIFY GPU ACCESS:
#   docker run --rm --gpus all nvidia/cuda:12.0-base nvidia-smi

services:
  ollama:
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all          # Use 'count: 1' to limit to one GPU
              capabilities: [gpu]
